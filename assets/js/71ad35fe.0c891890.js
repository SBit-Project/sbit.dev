"use strict";(self.webpackChunksbit_website=self.webpackChunksbit_website||[]).push([[3688],{3905:function(e,t,a){a.d(t,{Zo:function(){return u},kt:function(){return b}});var i=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function n(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t){if(null==e)return{};var a,i,r=function(e,t){if(null==e)return{};var a,i,r={},n=Object.keys(e);for(i=0;i<n.length;i++)a=n[i],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(i=0;i<n.length;i++)a=n[i],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var o=i.createContext({}),p=function(e){var t=i.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},u=function(e){var t=p(e.components);return i.createElement(o.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},l=i.forwardRef((function(e,t){var a=e.components,r=e.mdxType,n=e.originalType,o=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),l=p(a),b=r,f=l["".concat(o,".").concat(b)]||l[b]||d[b]||n;return a?i.createElement(f,s(s({ref:t},u),{},{components:a})):i.createElement(f,s({ref:t},u))}));function b(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var n=a.length,s=new Array(n);s[0]=l;var c={};for(var o in t)hasOwnProperty.call(t,o)&&(c[o]=t[o]);c.originalType=e,c.mdxType="string"==typeof e?e:r,s[1]=c;for(var p=2;p<n;p++)s[p]=a[p];return i.createElement.apply(null,s)}return i.createElement.apply(null,a)}l.displayName="MDXCreateElement"},5399:function(e,t,a){a.r(t),a.d(t,{assets:function(){return u},contentTitle:function(){return o},default:function(){return b},frontMatter:function(){return c},metadata:function(){return p},toc:function(){return d}});var i=a(7462),r=a(3366),n=(a(7294),a(3905)),s=["components"],c={title:"SBit Script",description:"SBit Script",keywords:["sbit","bitcoin","blockchain","ethereum","sbitcore","tools"],sidebar_position:12},o=void 0,p={unversionedId:"Tools/SBitcore-lib/script",id:"Tools/SBitcore-lib/script",title:"SBit Script",description:"SBit Script",source:"@site/docs/Tools/SBitcore-lib/script.md",sourceDirName:"Tools/SBitcore-lib",slug:"/Tools/SBitcore-lib/script",permalink:"/sbit.dev/docs/Tools/SBitcore-lib/script",tags:[],version:"current",sidebarPosition:12,frontMatter:{title:"SBit Script",description:"SBit Script",keywords:["sbit","bitcoin","blockchain","ethereum","sbitcore","tools"],sidebar_position:12},sidebar:"tutorialSidebar",previous:{title:"SBit Public Key",permalink:"/sbit.dev/docs/Tools/SBitcore-lib/publickey"},next:{title:"SBit Transaction",permalink:"/sbit.dev/docs/Tools/SBitcore-lib/transaction"}},u={},d=[{value:"Script creation",id:"script-creation",level:2},{value:"Pay to Public Key Hash (p2pkh)",id:"pay-to-public-key-hash-p2pkh",level:3},{value:"Pay to Public Key (p2pk)",id:"pay-to-public-key-p2pk",level:3},{value:"Pay to Multisig (p2ms)",id:"pay-to-multisig-p2ms",level:3},{value:"Pay to Script Hash (p2sh)",id:"pay-to-script-hash-p2sh",level:3},{value:"Data output",id:"data-output",level:3},{value:"Custom Scripts",id:"custom-scripts",level:3},{value:"Script Parsing and Identification",id:"script-parsing-and-identification",level:2},{value:"Script Interpreting and Validation",id:"script-interpreting-and-validation",level:2}],l={toc:d};function b(e){var t=e.components,a=(0,r.Z)(e,s);return(0,n.kt)("wrapper",(0,i.Z)({},l,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"All SBIT transactions have scripts embedded into its inputs and outputs. The scripts use a very simple programming language, which is evaluated from left to right using a stack. The language is designed such that it guarantees all scripts will execute in a limited amount of time (it is not Turing-Complete)."),(0,n.kt)("p",null,"When a transaction is validated, the input scripts are concatenated with the output scripts and evaluated. To be valid, all transaction scripts must evaluate to true.  A good analogy for how this works is that the output scripts are puzzles that specify in which conditions can those SBITs be spent. The input scripts provide the correct data to make those output scripts evaluate to true."),(0,n.kt)("p",null,"The ",(0,n.kt)("inlineCode",{parentName:"p"},"Script")," object provides an interface to construct, parse, and identify SBIT scripts. It also gives simple interfaces to create most common script types. This class is useful if you want to create custom input or output scripts. In other case, you should probably use ",(0,n.kt)("inlineCode",{parentName:"p"},"Transaction"),"."),(0,n.kt)("h2",{id:"script-creation"},"Script creation"),(0,n.kt)("p",null,"Here's how to use ",(0,n.kt)("inlineCode",{parentName:"p"},"Script")," to create the five most common script types:"),(0,n.kt)("h3",{id:"pay-to-public-key-hash-p2pkh"},"Pay to Public Key Hash (p2pkh)"),(0,n.kt)("p",null,"This is the most commonly used transaction output script. It's used to pay to a SBIT address (a SBIT address is a public key hash encoded in base58check)"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-javascript"},"// create a new p2pkh paying to a specific address\nvar address = Address.fromString('1NaTVwXDDUJaXDQajoa9MqHhz4uTxtgK14');\nvar script = Script.buildPublicKeyHashOut(address);\nassert(script.toString() === 'OP_DUP OP_HASH160 20 0xecae7d092947b7ee4998e254aa48900d26d2ce1d OP_EQUALVERIFY OP_CHECKSIG');\n")),(0,n.kt)("h3",{id:"pay-to-public-key-p2pk"},"Pay to Public Key (p2pk)"),(0,n.kt)("p",null,"Pay to public key scripts are a simplified form of the p2pkh, but aren't commonly used in new transactions anymore, because p2pkh scripts are more secure (the public key is not revealed until the output is spent)."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-javascript"},"// create a new p2pk paying to a specific public key\nvar pubkey = new PublicKey('022df8750480ad5b26950b25c7ba79d3e37d75f640f8e5d9bcd5b150a0f85014da');\nvar script = Script.buildPublicKeyOut(pubkey);\nassert(script.toString() === '33 0x022df8750480ad5b26950b25c7ba79d3e37d75f640f8e5d9bcd5b150a0f85014da OP_CHECKSIG');\n")),(0,n.kt)("h3",{id:"pay-to-multisig-p2ms"},"Pay to Multisig (p2ms)"),(0,n.kt)("p",null,"Multisig outputs allow to share control of SBITs between several keys. When creating the script, one specifies the public keys that control the funds, and how many of those keys are required to sign off spending transactions to be valid. An output with N public keys of which M are required is called an m-of-n output (For example, 2-of-3, 3-of-5, 4-of-4, etc.)"),(0,n.kt)("p",null,"Note that regular multisig outputs are rarely used nowadays. The best practice is to use a p2sh multisig output (See Script#toScriptHashOut())."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-javascript"},"// create a new 2-of-3 multisig output from 3 given public keys\nvar pubkeys = [\n  new PublicKey('022df8750480ad5b26950b25c7ba79d3e37d75f640f8e5d9bcd5b150a0f85014da'),\n  new PublicKey('03e3818b65bcc73a7d64064106a859cc1a5a728c4345ff0b641209fba0d90de6e9'),\n  new PublicKey('021f2f6e1e50cb6a953935c3601284925decd3fd21bc445712576873fb8c6ebc18'),\n];\nvar threshold = 2;\nvar script = Script.buildMultisigOut(pubkeys, threshold);\nassert(script.toString() === 'OP_2 33 0x022df8750480ad5b26950b25c7ba79d3e37d75f640f8e5d9bcd5b150a0f85014da'\n      + ' 33 0x03e3818b65bcc73a7d64064106a859cc1a5a728c4345ff0b641209fba0d90de6e9'\n      + ' 33 0x021f2f6e1e50cb6a953935c3601284925decd3fd21bc445712576873fb8c6ebc18 OP_3 OP_CHECKMULTISIG');\n")),(0,n.kt)("h3",{id:"pay-to-script-hash-p2sh"},"Pay to Script Hash (p2sh)"),(0,n.kt)("p",null,"Pay to script hash outputs are scripts that contain the hash of another script, called ",(0,n.kt)("inlineCode",{parentName:"p"},"redeemScript"),". To spend SBITs sent in a p2sh output, the spending transaction must provide a script matching the script hash and data which makes the script evaluate to true.  This allows to defer revealing the spending conditions to the moment of spending. It also makes it possible for the receiver to set the conditions to spend those SBITs."),(0,n.kt)("p",null,"Most multisig transactions today use p2sh outputs where the ",(0,n.kt)("inlineCode",{parentName:"p"},"redeemScript")," is a multisig output."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-javascript"},"// create a p2sh multisig output\nvar pubkeys = [\n  new PublicKey('022df8750480ad5b26950b25c7ba79d3e37d75f640f8e5d9bcd5b150a0f85014da'),\n  new PublicKey('03e3818b65bcc73a7d64064106a859cc1a5a728c4345ff0b641209fba0d90de6e9'),\n  new PublicKey('021f2f6e1e50cb6a953935c3601284925decd3fd21bc445712576873fb8c6ebc18'),\n];\nvar redeemScript = Script.buildMultisigOut(pubkeys, 2);\nvar script = redeemScript.toScriptHashOut();\nassert(script.toString() === 'OP_HASH160 20 0x620a6eeaf538ec9eb89b6ae83f2ed8ef98566a03 OP_EQUAL');\n")),(0,n.kt)("h3",{id:"data-output"},"Data output"),(0,n.kt)("p",null,"Data outputs are used to push data into the blockchain. Up to 40 bytes can be pushed in a standard way, but more data can be used, if a miner decides to accept the transaction."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-javascript"},"var data = 'hello world!!!';\nvar script = Script.buildDataOut(data);\nassert(script.toString() === 'OP_RETURN 14 0x68656c6c6f20776f726c64212121'\n")),(0,n.kt)("h3",{id:"custom-scripts"},"Custom Scripts"),(0,n.kt)("p",null,"To create a custom ",(0,n.kt)("inlineCode",{parentName:"p"},"Script")," instance, you must rely on the lower-level methods ",(0,n.kt)("inlineCode",{parentName:"p"},"add")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"prepend"),". Both methods accept the same parameter types, and insert an opcode or data at the beginning (",(0,n.kt)("inlineCode",{parentName:"p"},"prepend"),") or end (",(0,n.kt)("inlineCode",{parentName:"p"},"add"),") of the ",(0,n.kt)("inlineCode",{parentName:"p"},"Script"),"."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"var script = Script()\n  .add('OP_IF')                       // add an opcode by name\n  .prepend(114)                       // add OP_2SWAP by code\n  .add(Opcode.OP_NOT)                 // add an opcode object\n  .add(new Buffer('bacacafe', 'hex')) // add a data buffer (will append the size of the push operation first)\n\nassert(script.toString() === 'OP_2SWAP OP_IF OP_NOT 4 0xbacacafe');\n")),(0,n.kt)("h2",{id:"script-parsing-and-identification"},"Script Parsing and Identification"),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"Script")," has an easy interface to parse raw scripts from the network or sbitd, and to extract useful information. An illustrative example (for more options check the API reference)"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-javascript"},"var raw_script = new Buffer('5221022df8750480ad5b26950b25c7ba79d3e37d75f640f8e5d9bcd5b150a0f85014da2103e3818b65bcc73a7d64064106a859cc1a5a728c4345ff0b641209fba0d90de6e921021f2f6e1e50cb6a953935c3601284925decd3fd21bc445712576873fb8c6ebc1853ae', 'hex');\nvar s = new Script(raw_script);\nconsole.log(s.toString());\n// 'OP_2 33 0x022df8750480ad5b26950b25c7ba79d3e37d75f640f8e5d9bcd5b150a0f85014da 33 0x03e3818b65bcc73a7d64064106a859cc1a5a728c4345ff0b641209fba0d90de6e9 33 0x021f2f6e1e50cb6a953935c3601284925decd3fd21bc445712576873fb8c6ebc18 OP_3 OP_CHECKMULTISIG'\n\ns.isPublicKeyHashOut() // false\ns.isScriptHashOut() // false\ns.isMultisigOut() // true\n")),(0,n.kt)("h2",{id:"script-interpreting-and-validation"},"Script Interpreting and Validation"),(0,n.kt)("p",null,"You can use it like this:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"var inputScript = Script('OP_1');\nvar outputScript = Script('OP_15 OP_ADD OP_16 OP_EQUAL');\n\nvar verified = Interpreter().verify(inputScript, outputScript);\n// verified will be true\n")),(0,n.kt)("p",null,"Note that ",(0,n.kt)("inlineCode",{parentName:"p"},"verify")," expects two scripts: one is the input script (scriptSig) and the other is the output script (scriptPubkey). This is because different conditions are checked for each."),(0,n.kt)("p",null,"It also accepts some optional parameters, assuming defaults if not provided:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"// first we create a transaction\nvar tx = new Transaction()\n  .from(utxo)\n  .to(toAddress, 100000)\n  .sign(privateKey);\n\n// we then extract the signature from the first input\nvar inputIndex = 0;\nvar signature = tx.getSignatures(privateKey)[inputIndex].signature;\n\nvar scriptSig = Script.buildPublicKeyHashIn(publicKey, signature);\nvar flags = Interpreter.SCRIPT_VERIFY_P2SH | Interpreter.SCRIPT_VERIFY_STRICTENC;\nvar verified = Interpreter().verify(scriptSig, scriptPubkey, tx, inputIndex, flags);\n")))}b.isMDXComponent=!0}}]);